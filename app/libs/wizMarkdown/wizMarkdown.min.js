var MarkdownDeep=new function(){function e(e,t){if(e.indexOf!==undefined)return e.indexOf(t);for(var n=0;n<e.length;n++){if(e[n]===t)return n}return-1}function t(){this.m_SpanFormatter=new at(this);this.m_SpareBlocks=[];this.m_StringBuilder=new x;this.m_StringBuilderFinal=new x}function r(e,t,n,r){return e.slice(0,t).concat(r).concat(e.slice(t+n))}function i(e){return e>="0"&&e<="9"}function s(e){return e>="0"&&e<="9"||e>="a"&&e<="f"||e>="A"&&e<="F"}function o(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}function u(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"}function a(e){return e==" "||e=="	"||e=="\r"||e=="\n"}function f(e){return e==" "||e=="	"}function l(e){return e=="\r"||e=="\n"}function c(e){return e=="*"||e=="_"}function h(e,t){switch(e){case"\\":case"`":case"*":case"_":case"{":case"}":case"[":case"]":case"(":case")":case">":case"#":case"+":case"-":case".":case"!":return true;case":":case"|":case"=":case"<":return t}return false}function p(e,t){if(e.charAt(t)!="&")return-1;var n=t;t++;var r;if(e.charAt(t)=="#"){t++;if(e.charAt(t)=="x"||e.charAt(t)=="X"){t++;r=s}else{r=i}}else{r=u}if(r(e.charAt(t))){t++;while(r(e.charAt(t)))t++;if(e.charAt(t)==";"){t++;return t}}t=n;return-1}function d(e,t){var n=e.indexOf("\\");if(n<0)return e;var r=new x;var i=0;while(n>=0){if(h(e.charAt(n+1),t)){if(n>i)r.Append(e.substr(i,n-i));i=n+1}n=e.indexOf("\\",n+1)}if(i<e.length)r.Append(e.substr(i,e.length-i));return r.ToString()}function v(e){var t=0;var n=e.length;while(t<n&&a(e.charAt(t)))t++;while(n-1>t&&a(e.charAt(n-1)))n--;return e.substr(t,n-t)}function m(e){var t=e.indexOf("@");if(t<0)return false;var n=e.lastIndexOf(".");if(n<t)return false;return true}function g(e){e=e.toLowerCase();if(e.substr(0,7)=="http://")return true;if(e.substr(0,8)=="https://")return true;if(e.substr(0,6)=="ftp://")return true;if(e.substr(0,7)=="file://")return true;return false}function y(e){if(!e)return false;if(!o(e.charAt(0)))return false;for(var t=0;t<e.length;t++){var n=e.charAt(t);if(u(n)||n=="_"||n=="-"||n==":"||n==".")continue;return false}return true}function b(e,t,n){var r=n-1;while(r>=t&&a(e.charAt(r))){r--}if(r<t||e.charAt(r)!="}")return null;var i=r;r--;while(r>=t&&e.charAt(r)!="{")r--;if(r<t||e.charAt(r+1)!="#")return null;var s=r+2;var o=e.substr(s,i-s);if(!y(o))return null;while(r>t&&a(e.charAt(r-1)))r--;return{id:o,end:r}}function w(e,t){return e.substr(0,t.length)==t}function E(e,t){return e.substr(-t.length)==t}function S(e){return e.indexOf("://")>=0||w(e,"mailto:")}function x(){this.m_content=[]}function T(){this.reset.apply(this,arguments)}function A(e){this.name=e;this.attributes={};this.flags=0;this.closed=false;this.closing=false}function O(e){e=e.toLowerCase();return e.substr(0,7)=="http://"||e.substr(0,8)=="https://"||e.substr(0,6)=="ftp://"}function M(e){var t=e.m_position;var n=_(e);if(n!=null)return n;e.m_position=t;return null}function _(e){if(e.current()!="<")return null;e.SkipForward(1);if(e.SkipString("!--")){e.Mark();if(e.Find("-->")){var t=new A("!");t.attributes["content"]=e.Extract();t.closed=true;e.SkipForward(3);return t}}var n=e.SkipChar("/");e.Mark();if(!e.SkipIdentifier())return null;var r=new A(e.Extract());r.closing=n;if(n){if(e.current()!=">")return null;e.SkipForward(1);return r}while(!e.eof()){e.SkipWhitespace();if(e.SkipString("/>")){r.closed=true;return r}if(e.SkipChar(">")){return r}e.Mark();if(!e.SkipIdentifier())return null;var i=e.Extract();e.SkipWhitespace();if(!e.SkipChar("="))return null;e.SkipWhitespace();if(e.SkipChar('"')){e.Mark();if(!e.Find('"'))return null;r.attributes[i]=e.Extract();e.SkipForward(1)}else{e.Mark();while(!e.eof()&&!a(e.current())&&e.current()!=">"&&e.current()!="/")e.SkipForward(1);if(!e.eof()){r.attributes[i]=e.Extract()}}}return null}function q(e,t,n){this.id=e;this.url=t;if(n==undefined)this.title=null;else this.title=n}function R(e,t){var n=e.m_position;var r=U(e,t);if(r==null)e.m_position=n;return r}function U(e,t){e.SkipWhitespace();if(!e.SkipChar("["))return null;e.Mark();if(!e.Find("]"))return null;var n=e.Extract();if(n.length==0)return null;if(!e.SkipString("]:"))return null;var r=z(e,n,t);e.SkipLinespace();if(!e.eol())return null;return r}function z(e,t,n){e.SkipWhitespace();if(e.eol())return null;var r=new q(t);if(e.SkipChar("<")){e.Mark();while(e.current()!=">"){if(e.eof())return null;e.SkipEscapableChar(n)}var i=e.Extract();if(!e.SkipChar(">"))return null;r.url=d(v(i),n);e.SkipWhitespace()}else{e.Mark();var s=1;while(!e.eol()){var o=e.current();if(a(o))break;if(t==null){if(o=="(")s++;else if(o==")"){s--;if(s==0)break}}e.SkipEscapableChar(n)}r.url=d(v(e.Extract()),n)}e.SkipLinespace();if(e.current()==")")return r;var u=e.eol();var f=e.m_position;if(e.eol()){e.SkipEol();e.SkipLinespace()}var l;switch(e.current()){case"'":case'"':l=e.current();break;case"(":l=")";break;default:if(u){e.m_position=f;return r}else return null}e.SkipForward(1);e.Mark();while(true){if(e.eol())return null;if(e.current()==l){if(l!=")"){var c=e.m_position;e.SkipForward(1);e.SkipLinespace();if(t==null&&e.current()!=")"||t!=null&&!e.eol()){continue}e.m_position=c}break}e.SkipEscapableChar(n)}r.title=d(e.Extract(),n);e.SkipForward(1);return r}function W(e,t){this.def=e;this.link_text=t}function ut(e,t,n){this.type=e;this.startOffset=t;this.length=n;this.data=null}function at(e){this.m_Markdown=e;this.m_Scanner=new T;this.m_SpareTokens=[];this.m_DisableLinks=false;this.m_Tokens=[]}function It(){}function qt(e,t){this.m_Markdown=e;this.m_parentType=ft;this.m_bMarkdownInHtml=t}function Qt(){this.m_Columns=[];this.m_Headers=null;this.m_Rows=[]}function Gt(e){e.SkipLinespace();if(e.current()!="|"&&e.current()!=":"&&e.current()!="-")return null;var t=null;if(e.SkipChar("|")){t=new Qt;t.LeadingBar=true}while(true){e.SkipLinespace();if(e.current()=="|")return null;var n=e.SkipChar(":");while(e.current()=="-")e.SkipForward(1);var r=e.SkipChar(":");e.SkipLinespace();var i=Vt;if(n&&r)i=Kt;else if(n)i=$t;else if(r)i=Jt;if(e.eol()){if(t==null)return null;t.m_Columns.push(i);return t}if(!e.SkipChar("|"))return null;if(t==null)t=new Qt;t.m_Columns.push(i);e.SkipLinespace();if(e.eol()){t.TrailingBar=true;return t}}}t.prototype={SafeMode:false,ExtraMode:false,MarkdownInHtml:false,AutoHeadingIDs:false,UrlBaseLocation:null,UrlRootLocation:null,NewWindowForExternalLinks:false,NewWindowForLocalLinks:false,NoFollowLinks:false,HtmlClassFootnotes:"footnotes",HtmlClassTitledImages:null,RenderingTitledImage:false,FormatCodeBlockAttributes:null,FormatCodeBlock:null,ExtractHeadBlocks:false,HeadBlockContent:""};var n=t.prototype;t.prototype.GetListItems=function(e,t){var n=this.ProcessBlocks(e);var i;for(i=0;i<n.length;i++){var s=n[i];if((s.blockType==_t||s.blockType==Tt||s.blockType==Mt)&&s.children){n=r(n,i,1,s.children);i--;continue}if(t<s.lineStart){break}}i--;if(i<0)return null;var o=n[i];if(o.blockType!=Ot&&o.blockType!=At)return null;var u=[];var a=o.children;for(var f=0;f<a.length;f++){u.push(a[f].lineStart)}i++;if(i<n.length){u.push(n[i].lineStart)}else{u.push(e.length)}return u};t.prototype.Transform=function(e){var t=e.indexOf("\r");if(t>=0){var n=e.indexOf("\n");if(n>=0){if(n<t){e=e.replace(/\n\r/g,"\n")}else{e=e.replace(/\r\n/g,"\n")}}e=e.replace(/\r/g,"\n")}this.HeadBlockContent="";var r=this.ProcessBlocks(e);if(this.m_Abbreviations!=null){var i=[];for(var s in this.m_Abbreviations){i.push(this.m_Abbreviations[s])}i.sort(function(e,t){return t.Abbr.length-e.Abbr.length});this.m_Abbreviations=i}var o=this.m_StringBuilderFinal;o.Clear();for(var u=0;u<r.length;u++){var a=r[u];a.Render(this,o)}if(this.m_UsedFootnotes.length>0){o.Append('\n<div class="');o.Append(this.HtmlClassFootnotes);o.Append('">\n');o.Append("<hr />\n");o.Append("<ol>\n");for(var u=0;u<this.m_UsedFootnotes.length;u++){var f=this.m_UsedFootnotes[u];o.Append('<li id="#fn:');o.Append(f.data);o.Append('">\n');var l='<a href="#fnref:'+f.data+'" rev="footnote">&#8617;</a>';var c=f.children[f.children.length-1];if(c.blockType==Et){c.blockType=Ft;c.data=l}else{c=new It;c.contentLen=0;c.blockType=Ft;c.data=l;f.children.push(c)}f.Render(this,o);o.Append("</li>\n")}o.Append("</ol\n");o.Append("</div>\n")}return o.ToString()};t.prototype.OnQualifyUrl=function(e){if(S(e))return e;if(w(e,"/")){var t=this.UrlRootLocation;if(!t){if(!this.UrlBaseLocation)return e;var n=this.UrlBaseLocation.indexOf("://");if(n==-1)n=0;else n+=3;n=this.UrlBaseLocation.indexOf("/",n);t=n<0?this.UrlBaseLocation:this.UrlBaseLocation.substr(0,n)}return t+e}else{if(!this.UrlBaseLocation)return e;if(!E(this.UrlBaseLocation,"/"))return this.UrlBaseLocation+"/"+e;else return this.UrlBaseLocation+e}};t.prototype.OnGetImageSize=function(e,t){return null};t.prototype.OnPrepareLink=function(e){var t=e.attributes["href"];if(this.NoFollowLinks){e.attributes["rel"]="nofollow"}if(this.NewWindowForExternalLinks&&S(t)||this.NewWindowForLocalLinks&&!S(t)){e.attributes["target"]="_blank"}e.attributes["href"]=this.OnQualifyUrl(t)};t.prototype.OnPrepareImage=function(e,t){var n=this.OnGetImageSize(e.attributes["src"],t);if(n!=null){e.attributes["width"]=n.width;e.attributes["height"]=n.height}e.attributes["src"]=this.OnQualifyUrl(e.attributes["src"])};t.prototype.GetLinkDefinition=function(e){var t=this.m_LinkDefinitions[e];if(t==undefined)return null;else return t};n.ProcessBlocks=function(e){this.m_LinkDefinitions=[];this.m_Footnotes=[];this.m_UsedFootnotes=[];this.m_UsedHeaderIDs=[];this.m_Abbreviations=null;return(new qt(this,this.MarkdownInHtml)).Process(e)};n.AddLinkDefinition=function(e){this.m_LinkDefinitions[e.id]=e};n.AddFootnote=function(e){this.m_Footnotes[e.data]=e};n.ClaimFootnote=function(e){var t=this.m_Footnotes[e];if(t!=undefined){this.m_UsedFootnotes.push(t);delete this.m_Footnotes[e];return this.m_UsedFootnotes.length-1}else return-1};n.AddAbbreviation=function(e,t){if(this.m_Abbreviations==null){this.m_Abbreviations=[]}this.m_Abbreviations[e]={Abbr:e,Title:t}};n.GetAbbreviations=function(){return this.m_Abbreviations};n.MakeUniqueHeaderID=function(e,t,n){if(!this.AutoHeadingIDs)return null;var r=this.m_SpanFormatter.MakeID(e,t,n);if(!r)r="section";var i=r;var s=1;while(this.m_UsedHeaderIDs[i]!=undefined){i=r+"-"+s.toString();s++}this.m_UsedHeaderIDs[i]=true;return i};n.GetStringBuilder=function(){this.m_StringBuilder.Clear();return this.m_StringBuilder};n=x.prototype;n.Append=function(e){if(e)this.m_content.push(e)};n.Clear=function(){this.m_content.length=0};n.ToString=function(){return this.m_content.join("")};n.HtmlRandomize=function(e){var t=e.length;for(var n=0;n<t;n++){var r=Math.random();if(r>.9&&e.charAt(n)!="@"){this.Append(e.charAt(n))}else if(r>.45){this.Append("&#");this.Append(e.charCodeAt(n).toString());this.Append(";")}else{this.Append("&#x");this.Append(e.charCodeAt(n).toString(16));this.Append(";")}}};n.HtmlEncode=function(e,t,n){var r=t+n;var i=t;var s;for(s=t;s<r;s++){switch(e.charAt(s)){case"&":if(s>i)this.Append(e.substr(i,s-i));this.Append("&");i=s+1;break;case"<":if(s>i)this.Append(e.substr(i,s-i));this.Append("&lt;");i=s+1;break;case">":if(s>i)this.Append(e.substr(i,s-i));this.Append("&gt;");i=s+1;break;case'"':if(s>i)this.Append(e.substr(i,s-i));this.Append("&quot;");i=s+1;break}}if(s>i)this.Append(e.substr(i,s-i))};n.SmartHtmlEncodeAmpsAndAngles=function(e,t,n){var r=t+n;var i=t;var s;for(s=t;s<r;s++){switch(e.charAt(s)){case"&":var o=p(e,s);if(o<0){if(s>i){this.Append(e.substr(i,s-i))}this.Append("&");i=s+1}else{s=o-1}break;case"<":if(s>i)this.Append(e.substr(i,s-i));this.Append("&lt;");i=s+1;break;case">":if(s>i)this.Append(e.substr(i,s-i));this.Append("&gt;");i=s+1;break;case'"':if(s>i)this.Append(e.substr(i,s-i));this.Append("&quot;");i=s+1;break}}if(s>i)this.Append(e.substr(i,s-i))};n.SmartHtmlEncodeAmps=function(e,t,n){var r=t+n;var i=t;var s;for(s=t;s<r;s++){switch(e.charAt(s)){case"&":var o=p(e,s);if(o<0){if(s>i){this.Append(e.substr(i,s-i))}this.Append("&");i=s+1}else{s=o-1}break}}if(s>i)this.Append(e.substr(i,s-i))};n.HtmlEncodeAndConvertTabsToSpaces=function(e,t,n){var r=t+n;var i=t;var s=0;var o;for(o=t;o<r;o++){switch(e.charAt(o)){case"	":if(o>i){this.Append(e.substr(i,o-i))}i=o+1;this.Append(" ");s++;while(s%4!=0){this.Append(" ");s++}s--;break;case"\r":case"\n":if(o>i)this.Append(e.substr(i,o-i));this.Append("\n");i=o+1;continue;case"&":if(o>i)this.Append(e.substr(i,o-i));this.Append("&");i=o+1;break;case"<":if(o>i)this.Append(e.substr(i,o-i));this.Append("&lt;");i=o+1;break;case">":if(o>i)this.Append(e.substr(i,o-i));this.Append("&gt;");i=o+1;break;case'"':if(o>i)this.Append(e.substr(i,o-i));this.Append("&quot;");i=o+1;break}s++}if(o>i)this.Append(e.substr(i,o-i))};n=T.prototype;n.bof=function(){return this.m_position==this.start};n.eof=function(){return this.m_position>=this.end};n.eol=function(){if(this.m_position>=this.end)return true;var e=this.buf.charAt(this.m_position);return e=="\r"||e=="\n"||e==undefined||e==""};n.reset=function(){this.buf=arguments.length>0?arguments[0]:null;this.start=arguments.length>1?arguments[1]:0;this.end=arguments.length>2?this.start+arguments[2]:this.buf==null?0:this.buf.length;this.m_position=this.start;this.charset_offsets={}};n.current=function(){if(this.m_position>=this.end)return"\0";return this.buf.charAt(this.m_position)};n.remainder=function(){return this.buf.substr(this.m_position)};n.SkipToEof=function(){this.m_position=this.end};n.SkipForward=function(e){this.m_position+=e};n.SkipToEol=function(){this.m_position=this.buf.indexOf("\n",this.m_position);if(this.m_position<0)this.m_position=this.end};n.SkipEol=function(){var e=this.m_position;if(this.buf.charAt(this.m_position)=="\r")this.m_position++;if(this.buf.charAt(this.m_position)=="\n")this.m_position++;return this.m_position!=e};n.SkipToNextLine=function(){this.SkipToEol();this.SkipEol()};n.CharAtOffset=function(e){if(this.m_position+e>=this.end)return"\0";return this.buf.charAt(this.m_position+e)};n.SkipChar=function(e){if(this.buf.charAt(this.m_position)==e){this.m_position++;return true}return false};n.SkipString=function(e){if(this.buf.substr(this.m_position,e.length)==e){this.m_position+=e.length;return true}return false};n.SkipWhitespace=function(){var e=this.m_position;while(true){var t=this.buf.charAt(this.m_position);if(t!=" "&&t!="	"&&t!="\r"&&t!="\n")break;this.m_position++}return this.m_position!=e};n.SkipLinespace=function(){var e=this.m_position;while(true){var t=this.buf.charAt(this.m_position);if(t!=" "&&t!="	")break;this.m_position++}return this.m_position!=e};n.FindRE=function(e){e.lastIndex=this.m_position;var t=e.exec(this.buf);if(t==null){this.m_position=this.end;return false}if(t.index+t[0].length>this.end){this.m_position=this.end;return false}this.m_position=t.index;return true};n.FindOneOf=function(e){var t=-1;for(var r in e){var i=e[r];if(i==null){i={};i.m_searched_from=-1;i.m_found_at=-1;e[r]=i}if(i.m_searched_from==-1||this.m_position<i.m_searched_from||this.m_position>=i.m_found_at&&i.m_found_at!=-1){i.m_searched_from=this.m_position;i.m_found_at=this.buf.indexOf(r,this.m_position)}if(t==-1||i.m_found_at<t){t=i.m_found_at}}if(t==-1){t=this.end;return false}n.m_position=t;return true};n.Find=function(e){this.m_position=this.buf.indexOf(e,this.m_position);if(this.m_position<0){this.m_position=this.end;return false}return true};n.Mark=function(){this.mark=this.m_position};n.Extract=function(){if(this.mark>=this.m_position)return"";else return this.buf.substr(this.mark,this.m_position-this.mark)};n.SkipIdentifier=function(){var e=this.buf.charAt(this.m_position);if(e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"){this.m_position++;while(true){e=this.buf.charAt(this.m_position);if(e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9")this.m_position++;else return true}}return false};n.SkipFootnoteID=function(){var e=this.m_position;this.SkipLinespace();this.Mark();while(true){var t=this.current();if(u(t)||t=="-"||t=="_"||t==":"||t=="."||t==" ")this.SkipForward(1);else break}if(this.m_position>this.mark){var n=v(this.Extract());if(n.length>0){this.SkipLinespace();return n}}this.m_position=e;return null};n.SkipHtmlEntity=function(){if(this.buf.charAt(this.m_position)!="&")return false;var e=p(this.buf,this.m_position);if(e<0)return false;this.m_position=e;return true};n.SkipEscapableChar=function(e){if(this.buf.charAt(this.m_position)=="\\"&&h(this.buf.charAt(this.m_position+1),e)){this.m_position+=2;return true}else{if(this.m_position<this.end)this.m_position++;return false}};var N=1;var C=2;var k=4;var L=8;n=A.prototype;n.attributeCount=function(){if(!this.attributes)return 0;var e=0;for(var t in this.attributes)e++;return e};n.get_Flags=function(){if(this.flags==0){this.flags=I[this.name.toLowerCase()];if(this.flags==undefined){this.flags=C}}return this.flags};n.IsSafe=function(){var e=this.name.toLowerCase();if(!D[e])return false;var t=P[e];if(!t){return this.attributeCount()==0}if(!this.attributes)return true;for(var n in this.attributes){if(!t[n.toLowerCase()])return false}if(this.attributes["href"]){if(!O(this.attributes["href"]))return false}if(this.attributes["src"]){if(!O(this.attributes["src"]))return false}return true};n.RenderOpening=function(e){e.Append("<");e.Append(this.name);for(var t in this.attributes){e.Append(" ");e.Append(t);e.Append('="');e.Append(this.attributes[t]);e.Append('"')}if(this.closed)e.Append(" />");else e.Append(">")};n.RenderClosing=function(e){e.Append("</");e.Append(this.name);e.Append(">")};var D={b:1,blockquote:1,code:1,dd:1,dt:1,dl:1,del:1,em:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,i:1,kbd:1,li:1,ol:1,ul:1,p:1,pre:1,s:1,sub:1,sup:1,strong:1,strike:1,img:1,a:1};var P={a:{href:1,title:1},img:{src:1,width:1,height:1,alt:1,title:1}};var H=N;var B=C;var j=k;var F=L;var I={p:H|F,div:H,h1:H|F,h2:H|F,h3:H|F,h4:H|F,h5:H|F,h6:H|F,blockquote:H,pre:H,table:H,dl:H,ol:H,ul:H,form:H,fieldset:H,iframe:H,script:H|B,noscript:H|B,math:H|B,ins:H|B,del:H|B,img:H|B,li:F,dd:F,dt:F,td:F,th:F,legend:F,address:F,hr:H|j,"!":H|j,head:H};delete H;delete B;delete j;n=q.prototype;n.RenderLink=function(e,t,n){if(this.url.substr(0,7).toLowerCase()=="mailto:"){t.Append('<a href="');t.HtmlRandomize(this.url);t.Append('"');if(this.title){t.Append(' title="');t.SmartHtmlEncodeAmpsAndAngles(this.title,0,this.title.length);t.Append('"')}t.Append(">");t.HtmlRandomize(n);t.Append("</a>")}else{var r=new A("a");var i=e.GetStringBuilder();i.SmartHtmlEncodeAmpsAndAngles(this.url,0,this.url.length);r.attributes["href"]=i.ToString();if(this.title){i.Clear();i.SmartHtmlEncodeAmpsAndAngles(this.title,0,this.title.length);r.attributes["title"]=i.ToString()}e.OnPrepareLink(r);r.RenderOpening(t);t.Append(n);t.Append("</a>")}};n.RenderImg=function(e,t,n){var r=new A("img");var i=e.GetStringBuilder();i.SmartHtmlEncodeAmpsAndAngles(this.url,0,this.url.length);r.attributes["src"]=i.ToString();if(n){i.Clear();i.SmartHtmlEncodeAmpsAndAngles(n,0,n.length);r.attributes["alt"]=i.ToString()}if(this.title){i.Clear();i.SmartHtmlEncodeAmpsAndAngles(this.title,0,this.title.length);r.attributes["title"]=i.ToString()}r.closed=true;e.OnPrepareImage(r,e.RenderingTitledImage);r.RenderOpening(t)};var X=0;var V=1;var $=2;var J=3;var K=4;var Q=5;var G=6;var Y=7;var Z=8;var et=9;var tt=10;var nt=11;var rt=12;var it=13;var st=14;var ot=15;n=at.prototype;n.FormatParagraph=function(e,t,n,r){this.Tokenize(t,n,r);if(this.m_Tokens.length==1&&this.m_Markdown.HtmlClassTitledImages!=null&&this.m_Tokens[0].type==tt){var i=this.m_Tokens[0].data;e.Append('<div class="');e.Append(this.m_Markdown.HtmlClassTitledImages);e.Append('">\n');this.m_Markdown.RenderingTitledImage=true;this.Render(e,t);this.m_Markdown.RenderingTitledImage=false;e.Append("\n");if(i.def.title){e.Append("<p>");e.SmartHtmlEncodeAmpsAndAngles(i.def.title,0,i.def.title.length);e.Append("</p>\n")}e.Append("</div>\n")}else{e.Append("<p>");this.Render(e,t);e.Append("</p>\n")}};n.Format2=function(e,t){this.Format(e,t,0,t.length)};n.Format=function(e,t,n,r){this.Tokenize(t,n,r);this.Render(e,t)};n.FormatDirect=function(e){var t=new x;this.Format(t,e,0,e.length);return t.ToString()};n.MakeID=function(e,t,n){this.Tokenize(e,t,n);var r=this.m_Tokens;var i=new x;for(var s=0;s<r.length;s++){var a=r[s];switch(a.type){case X:i.Append(e.substr(a.startOffset,a.length));break;case et:i.Append(a.data.link_text);break}this.FreeToken(a)}var f=this.m_Scanner;f.reset(i.ToString());while(!f.eof()){if(o(f.current()))break;f.SkipForward(1)}i.Clear();while(!f.eof()){var c=f.current();if(u(c)||c=="_"||c=="-"||c==".")i.Append(c.toLowerCase());else if(c==" ")i.Append("-");else if(l(c)){i.Append("-");f.SkipEol();continue}f.SkipForward(1)}return i.ToString()};n.Render=function(e,t){var n=this.m_Tokens;var r=n.length;for(var i=0;i<r;i++){var s=n[i];switch(s.type){case X:e.HtmlEncode(t,s.startOffset,s.length);break;case V:e.SmartHtmlEncodeAmps(t,s.startOffset,s.length);break;case $:case nt:case rt:case it:e.Append(t.substr(s.startOffset,s.length));break;case Z:e.Append("<br />\n");break;case J:e.Append("<em>");break;case K:e.Append("</em>");break;case Q:e.Append("<strong>");break;case G:e.Append("</strong>");break;case Y:e.Append("<code>");e.HtmlEncode(t,s.startOffset,s.length);e.Append("</code>");break;case et:var o=s.data;var u=new at(this.m_Markdown);u.m_DisableLinks=true;o.def.RenderLink(this.m_Markdown,e,u.FormatDirect(o.link_text));break;case tt:var o=s.data;o.def.RenderImg(this.m_Markdown,e,o.link_text);break;case st:var a=s.data;e.Append('<sup id="fnref:');e.Append(a.id);e.Append('"><a href="#fn:');e.Append(a.id);e.Append('" rel="footnote">');e.Append(a.index+1);e.Append("</a></sup>");break;case ot:var f=s.data;e.Append("<abbr");if(f.Title){e.Append(' title="');e.HtmlEncode(f.Title,0,f.Title.length);e.Append('"')}e.Append(">");e.HtmlEncode(f.Abbr,0,f.Abbr.length);e.Append("</abbr>");break}this.FreeToken(s)}};n.Tokenize=function(e,t,n){var r=this.m_Scanner;r.reset(e,t,n);var i=this.m_Tokens;i.length=0;var s=null;var o=this.m_Markdown.GetAbbreviations();var a=o==null?/[\*\_\`\[\!\<\&\ \\]/g:null;var f=this.m_Markdown.ExtraMode;var c=r.m_position;while(!r.eof()){if(a!=null&&!r.FindRE(a))break;var p=r.m_position;var d=null;switch(r.current()){case"*":case"_":d=this.CreateEmphasisMark();if(d!=null){switch(d.type){case it:case nt:case rt:if(s==null){s=[]}s.push(d);break}}break;case"`":d=this.ProcessCodeSpan();break;case"[":case"!":var v=r.m_position;d=this.ProcessLinkOrImageOrFootnote();if(d==null)r.m_position=v;break;case"<":var m=r.m_position;var g=M(r);if(g!=null){if(!this.m_Markdown.SafeMode||g.IsSafe()){d=this.CreateToken(V,m,r.m_position-m)}else{r.m_position=m}}else{r.m_position=m;d=this.ProcessAutoLink();if(d==null)r.m_position=m}break;case"&":var m=r.m_position;if(r.SkipHtmlEntity()){d=this.CreateToken($,m,r.m_position-m)}break;case" ":if(r.CharAtOffset(1)==" "&&l(r.CharAtOffset(2))){r.SkipForward(2);if(!r.eof()){r.SkipEol();d=this.CreateToken(Z,p,0)}}break;case"\\":if(h(r.CharAtOffset(1),f)){d=this.CreateToken(X,r.m_position+1,1);r.SkipForward(2)}break}if(d==null&&o!=null&&!u(r.CharAtOffset(-1))){var y=r.m_position;for(var b in o){var w=o[b];if(r.SkipString(w.Abbr)&&!u(r.current())){d=this.CreateDataToken(ot,w);break}r.position=y}}if(d!=null){if(p>c){i.push(this.CreateToken(X,c,p-c))}i.push(d);c=r.m_position}else{r.SkipForward(1)}}if(r.m_position>c){i.push(this.CreateToken(X,c,r.m_position-c))}if(s!=null){this.ResolveEmphasisMarks(i,s)}};n.CreateEmphasisMark=function(){var e=this.m_Scanner;var t=e.current();var n=t=="*"?"_":"*";var r=e.m_position;if(e.bof()||a(e.CharAtOffset(-1))){while(c(e.current()))e.SkipForward(1);if(e.eof()||a(e.current())){return this.CreateToken($,r,e.m_position-r)}e.m_position=r}while(c(e.CharAtOffset(-1)))e.SkipForward(-1);var i=e.bof()||a(e.CharAtOffset(-1));e.m_position=r;while(e.current()==t){e.SkipForward(1)}var s=e.m_position-r;while(c(e.CharAtOffset(1)))e.SkipForward(1);var o=e.eof()||a(e.current());e.m_position=r+s;if(i){return this.CreateToken(nt,r,e.m_position-r)}if(o){return this.CreateToken(rt,r,e.m_position-r)}if(this.m_Markdown.ExtraMode&&t=="_")return null;return this.CreateToken(it,r,e.m_position-r)};n.SplitMarkToken=function(t,n,r,i){var s=this.CreateToken(r.type,r.startOffset+i,r.length-i);r.length=i;n.splice(e(n,r)+1,0,s);t.splice(e(t,r)+1,0,s);return s};n.ResolveEmphasisMarks=function(t,n){var r=this.m_Scanner.buf;var i=true;while(i){i=false;for(var s=0;s<n.length;s++){var o=n[s];if(o.type!=nt&&o.type!=it)continue;for(var u=s+1;u<n.length;u++){var a=n[u];if(a.type!=rt&&a.type!=it)break;if(r.charAt(o.startOffset)!=r.charAt(a.startOffset))continue;var f=Math.min(o.length,a.length);if(f>=3){f=f%2==1?1:2}if(o.length>f){o=this.SplitMarkToken(t,n,o,o.length-f);s--}if(a.length>f){this.SplitMarkToken(t,n,a,f)}o.type=f==1?J:Q;a.type=f==1?K:G;n.splice(e(n,o),1);n.splice(e(n,a),1);i=true;break}}}};n.ProcessAutoLink=function(){if(this.m_DisableLinks)return null;var e=this.m_Scanner;e.SkipForward(1);e.Mark();var t=this.m_Markdown.ExtraMode;while(!e.eof()){var n=e.current();if(a(n))break;if(n==">"){var r=d(e.Extract(),t);var i=null;if(m(r)){var s;if(r.toLowerCase().substr(0,7)=="mailto:"){s=r.substr(7)}else{s=r;r="mailto:"+r}i=new W(new q("auto",r,null),s)}else if(g(r)){i=new W(new q("auto",r,null),r)}if(i!=null){e.SkipForward(1);return this.CreateDataToken(et,i)}return null}e.SkipEscapableChar(t)}return null};n.ProcessLinkOrImageOrFootnote=function(){var e=this.m_Scanner;var t=e.SkipChar("!")?tt:et;if(!e.SkipChar("["))return null;var n=this.m_position;if(this.m_Markdown.ExtraMode&&t==et&&e.SkipChar("^")){e.SkipLinespace();e.Mark();var r=e.SkipFootnoteID();if(r!=null&&e.SkipChar("]")){var i=this.m_Markdown.ClaimFootnote(r);if(i>=0){return this.CreateDataToken(st,{index:i,id:r})}}this.m_position=n}if(this.m_DisableLinks)return null;var s=this.m_Markdown.ExtraMode;e.Mark();var o=1;while(!e.eof()){var u=e.current();if(u=="["){o++}else if(u=="]"){o--;if(o==0)break}e.SkipEscapableChar(s)}if(e.eof())return null;var f=d(e.Extract(),s);e.SkipForward(1);n=e.m_position;if(e.SkipChar("(")){var l=z(e,null,this.m_Markdown.ExtraMode);if(l==null)return null;e.SkipWhitespace();if(!e.SkipChar(")"))return null;return this.CreateDataToken(t,new W(l,f))}if(!e.SkipChar(" "))e.SkipChar("	");if(e.eol()){e.SkipEol();e.SkipLinespace()}var c=null;if(e.current()=="["){e.SkipForward(1);e.Mark();if(!e.Find("]"))return null;c=e.Extract();e.SkipForward(1)}else{e.m_position=n}if(!c){c=f;while(true){var h=c.indexOf("\n");if(h<0)break;var p=h;while(p>0&&a(c.charAt(p-1)))p--;var v=h;while(v<c.length&&a(c.charAt(v)))v++;c=c.substr(0,p)+" "+c.substr(v)}}var m=this.m_Markdown.GetLinkDefinition(c);if(m==null)return null;return this.CreateDataToken(t,new W(m,f))};n.ProcessCodeSpan=function(){var e=this.m_Scanner;var t=e.m_position;var n=0;while(e.SkipChar("`")){n++}e.SkipWhitespace();if(e.eof())return this.CreateToken(X,t,e.m_position-t);var r=e.m_position;if(!e.Find(e.buf.substr(t,n)))return this.CreateToken(X,t,e.m_position-t);var i=e.m_position+n;while(a(e.CharAtOffset(-1)))e.SkipForward(-1);var s=this.CreateToken(Y,r,e.m_position-r);e.m_position=i;return s};n.CreateToken=function(e,t,n){if(this.m_SpareTokens.length!=0){var r=this.m_SpareTokens.pop();r.type=e;r.startOffset=t;r.length=n;r.data=null;return r}else return new ut(e,t,n)};n.CreateDataToken=function(e,t){if(this.m_SpareTokens.length!=0){var n=this.m_SpareTokens.pop();n.type=e;n.data=t;return n}else{var n=new ut(e,0,0);n.data=t;return n}};n.FreeToken=function(e){e.data=null;this.m_SpareTokens.push(e)};var ft=0;var lt=1;var ct=2;var ht=3;var pt=4;var dt=5;var vt=6;var mt=7;var gt=8;var yt=9;var bt=10;var wt=11;var Et=12;var St=13;var xt=14;var Tt=15;var Nt=16;var Ct=17;var kt=18;var Lt=19;var At=20;var Ot=21;var Mt=22;var _t=23;var Dt=24;var Pt=25;var Ht=26;var Bt=27;var jt=28;var Ft=29;n=It.prototype;n.buf=null;n.blockType=ft;n.contentStart=0;n.contentLen=0;n.lineStart=0;n.lineLen=0;n.children=null;n.data=null;n.get_Content=function(){if(this.buf==null)return null;if(this.contentStart==-1)return this.buf;return this.buf.substr(this.contentStart,this.contentLen)};n.get_CodeContent=function(){var e=new x;for(var t=0;t<this.children.length;t++){e.Append(this.children[t].get_Content());e.Append("\n")}return e.ToString()};n.RenderChildren=function(e,t){for(var n=0;n<this.children.length;n++){this.children[n].Render(e,t)}};n.ResolveHeaderID=function(e){if(this.data!=null)return this.data;var t=b(this.buf,this.contentStart,this.get_contentEnd());var n=null;if(t!=null){this.set_contentEnd(t.end);n=t.id}else{n=e.MakeUniqueHeaderID(this.buf,this.contentStart,this.contentLen)}this.data=n;return n};n.Render=function(e,t){switch(this.blockType){case ft:return;case Et:e.m_SpanFormatter.FormatParagraph(t,this.buf,this.contentStart,this.contentLen);break;case Ct:e.m_SpanFormatter.Format(t,this.buf,this.contentStart,this.contentLen);t.Append("\n");break;case lt:case ct:case ht:case pt:case dt:case vt:if(e.ExtraMode&&!e.SafeMode){t.Append("<h"+(this.blockType-lt+1).toString());var n=this.ResolveHeaderID(e);if(n){t.Append(' id="');t.Append(n);t.Append('">')}else{t.Append(">")}}else{t.Append("<h"+(this.blockType-lt+1).toString()+">")}e.m_SpanFormatter.Format(t,this.buf,this.contentStart,this.contentLen);t.Append("</h"+(this.blockType-lt+1).toString()+">\n");break;case xt:t.Append("<hr />\n");return;case bt:case wt:t.Append("<li>");e.m_SpanFormatter.Format(t,this.buf,this.contentStart,this.contentLen);t.Append("</li>\n");break;case Tt:t.Append(this.buf.substr(this.contentStart,this.contentLen));return;case Nt:t.HtmlEncode(this.buf,this.contentStart,this.contentLen);return;case kt:t.Append("<pre");if(e.FormatCodeBlockAttributes!=null){t.Append(e.FormatCodeBlockAttributes(this.data))}t.Append("><code>");var r=t;if(e.FormatCodeBlock){r=t;t=new x}for(var i=0;i<this.children.length;i++){var s=this.children[i];t.HtmlEncodeAndConvertTabsToSpaces(s.buf,s.contentStart,s.contentLen);t.Append("\n")}if(e.FormatCodeBlock){r.Append(e.FormatCodeBlock(t.ToString(),this.data));t=r}t.Append("</code></pre>\n\n");return;case yt:t.Append("<blockquote>\n");this.RenderChildren(e,t);t.Append("</blockquote>\n");return;case Lt:t.Append("<li>\n");this.RenderChildren(e,t);t.Append("</li>\n");return;case At:t.Append("<ol>\n");this.RenderChildren(e,t);t.Append("</ol>\n");return;case Ot:t.Append("<ul>\n");this.RenderChildren(e,t);t.Append("</ul>\n");return;case Mt:var o=this.data;var u=o.name.toLowerCase();if(u=="a"){e.OnPrepareLink(o)}else if(u=="img"){e.OnPrepareImage(o,e.RenderingTitledImage)}o.RenderOpening(t);t.Append("\n");this.RenderChildren(e,t);o.RenderClosing(t);t.Append("\n");return;case _t:case jt:this.RenderChildren(e,t);return;case Dt:this.data.Render(e,t);return;case Pt:t.Append("<dd>");if(this.children!=null){t.Append("\n");this.RenderChildren(e,t)}else e.m_SpanFormatter.Format(t,this.buf,this.contentStart,this.contentLen);t.Append("</dd>\n");break;case Ht:if(this.children==null){var a=this.get_Content().split("\n");for(var i=0;i<a.length;i++){var f=a[i];t.Append("<dt>");e.m_SpanFormatter.Format2(t,v(f));t.Append("</dt>\n")}}else{t.Append("<dt>\n");this.RenderChildren(e,t);t.Append("</dt>\n")}break;case Bt:t.Append("<dl>\n");this.RenderChildren(e,t);t.Append("</dl>\n");return;case Ft:t.Append("<p>");if(this.contentLen>0){e.m_SpanFormatter.Format(t,this.buf,this.contentStart,this.contentLen);t.Append("&nbsp;")}t.Append(this.data);t.Append("</p>\n");break}};n.RevertToPlain=function(){this.blockType=Et;this.contentStart=this.lineStart;this.contentLen=this.lineLen};n.get_contentEnd=function(){return this.contentStart+this.contentLen};n.set_contentEnd=function(e){this.contentLen=e-this.contentStart};n.get_leadingSpaces=function(){var e=0;for(var t=this.lineStart;t<this.lineStart+this.lineLen;t++){if(this.buf.charAt(t)==" "){e++}else{break}}return e};n.CopyFrom=function(e){this.blockType=e.blockType;this.buf=e.buf;this.contentStart=e.contentStart;this.contentLen=e.contentLen;this.lineStart=e.lineStart;this.lineLen=e.lineLen;return this};n=qt.prototype;n.Process=function(e){var t=new T(e);return this.ScanLines(t)};n.ProcessRange=function(e,t,n){var r=new T(e,t,n);return this.ScanLines(r)};n.StartTable=function(e,t,n){if(n.length>1)return false;if(n.length==1){var r=e.m_position;e.m_position=n[0].lineStart;t.m_Headers=t.ParseRow(e);if(t.m_Headers==null)return false;e.m_position=r;n.length=0}while(true){var r=e.m_position;var i=t.ParseRow(e);if(i!=null){t.m_Rows.push(i);continue}e.m_position=r;break}return true};n.ScanLines=function(e){var t=[];var n=[];var r=-1;while(!e.eof()){var i=r==ft;var s=this.EvaluateLine(e);r=s.blockType;if(s.blockType==Pt){s.data=i}if(s.blockType==mt||s.blockType==gt){if(n.length>0){var o=n.pop();this.CollapseLines(t,n);if(o.blockType!=ft){o.RevertToPlain();o.blockType=s.blockType==mt?lt:ct;t.push(o);continue}}if(s.blockType==mt){s.RevertToPlain();n.push(s)}else{if(s.contentLen>=3){s.blockType=xt;t.push(s)}else{s.RevertToPlain();n.push(s)}}continue}var u=n.length>0?n[0].blockType:ft;if(s.blockType==Dt){var a=s.data;var f=e.m_position;if(!this.StartTable(e,a,n)){e.m_position=f;s.RevertToPlain()}else{t.push(s);continue}}switch(s.blockType){case ft:switch(u){case ft:this.FreeBlock(s);break;case Et:this.CollapseLines(t,n);this.FreeBlock(s);break;case yt:case bt:case wt:case Pt:case jt:case St:n.push(s);break}break;case Et:switch(u){case ft:case Et:n.push(s);break;case yt:case bt:case wt:case Pt:case jt:var o=n[n.length-1];if(o.blockType==ft){this.CollapseLines(t,n);n.push(s)}else{n.push(s)}break;case St:this.CollapseLines(t,n);n.push(s);break}break;case St:switch(u){case ft:n.push(s);break;case Et:case yt:var o=n[n.length-1];if(o.blockType==ft){this.CollapseLines(t,n);n.push(s)}else{s.RevertToPlain();n.push(s)}break;case bt:case wt:case St:case Pt:case jt:n.push(s);break}break;case yt:if(u!=yt){this.CollapseLines(t,n)}n.push(s);break;case bt:case wt:switch(u){case ft:n.push(s);break;case Et:case yt:var o=n[n.length-1];if(o.blockType==ft||this.m_parentType==bt||this.m_parentType==wt||this.m_parentType==Pt){this.CollapseLines(t,n);n.push(s)}else{s.RevertToPlain();n.push(s)}break;case bt:case wt:case Pt:case jt:if(s.blockType!=u){this.CollapseLines(t,n)}n.push(s);break;case St:this.CollapseLines(t,n);n.push(s);break}break;case Pt:case jt:switch(u){case ft:case Et:case Pt:case jt:this.CollapseLines(t,n);n.push(s);break;default:s.RevertToPlain();n.push(s);break}break;default:this.CollapseLines(t,n);t.push(s);break}}this.CollapseLines(t,n);if(this.m_Markdown.ExtraMode){this.BuildDefinitionLists(t)}return t};n.CreateBlock=function(e){var t;if(this.m_Markdown.m_SpareBlocks.length>1){t=this.m_Markdown.m_SpareBlocks.pop()}else{t=new It}t.lineStart=e;return t};n.FreeBlock=function(e){this.m_Markdown.m_SpareBlocks.push(e)};n.FreeBlocks=function(e){for(var t=0;t<e.length;t++)this.m_Markdown.m_SpareBlocks.push(e[t]);e.length=0};n.RenderLines=function(e){var t=this.m_Markdown.GetStringBuilder();for(var n=0;n<e.length;n++){var r=e[n];t.Append(r.buf.substr(r.contentStart,r.contentLen));t.Append("\n")}return t.ToString()};n.CollapseLines=function(e,t){while(t.length>0&&t[t.length-1].blockType==ft){this.FreeBlock(t.pop())}if(t.length==0){return}switch(t[0].blockType){case Et:var n=this.CreateBlock(t[0].lineStart);n.blockType=Et;n.buf=t[0].buf;n.contentStart=t[0].contentStart;n.set_contentEnd(t[t.length-1].get_contentEnd());e.push(n);this.FreeBlocks(t);break;case yt:var r=this.RenderLines(t);var i=new qt(this.m_Markdown,this.m_bMarkdownInHtml);i.m_parentType=yt;var s=this.CreateBlock(t[0].lineStart);s.blockType=yt;s.children=i.Process(r);this.FreeBlocks(t);e.push(s);break;case bt:case wt:e.push(this.BuildList(t));break;case Pt:if(e.length>0){var o=e[e.length-1];switch(o.blockType){case Et:o.blockType=Ht;break;case Pt:break;default:var u=this.CreateBlock(o.lineStart);u.blockType=Ht;u.children=[];u.children.push(o);e.pop();e.push(u);break}}e.push(this.BuildDefinition(t));break;case jt:this.m_Markdown.AddFootnote(this.BuildFootnote(t));break;case St:var a=this.CreateBlock(t[0].lineStart);a.blockType=kt;a.children=[];var f=t[0].get_Content();if(f.substr(0,2)=="{{"&&f.substr(f.length-2,2)=="}}"){a.data=f.substr(2,f.length-4);t.splice(0,1)}for(var l=0;l<t.length;l++){a.children.push(t[l])}e.push(a);t.length=0;break}};n.EvaluateLine=function(e){var t=this.CreateBlock(e.m_position);t.buf=e.buf;t.contentStart=e.m_position;t.contentLen=-1;t.blockType=this.EvaluateLineInternal(e,t);if(t.contentLen<0){e.SkipToEol();t.contentLen=e.m_position-t.contentStart}t.lineLen=e.m_position-t.lineStart;e.SkipEol();return t};n.EvaluateLineInternal=function(e,t){if(e.eol())return ft;var n=e.m_position;var r=e.current();if(r=="#"){var s=1;e.SkipForward(1);while(e.current()=="#"){s++;e.SkipForward(1)}if(s>6)s=6;e.SkipLinespace();t.contentStart=e.m_position;e.SkipToEol();if(this.m_Markdown.ExtraMode&&!this.m_Markdown.SafeMode){var o=b(e.buf,t.contentStart,e.m_position);if(o!=null){t.data=o.id;e.m_position=o.end}}while(e.m_position>t.contentStart&&e.CharAtOffset(-1)=="#"){e.SkipForward(-1)}while(e.m_position>t.contentStart&&a(e.CharAtOffset(-1))){e.SkipForward(-1)}t.contentLen=e.m_position-t.contentStart;e.SkipToEol();return lt+(s-1)}if(r=="-"||r=="="){var u=r;while(e.current()==u){e.SkipForward(1)}e.SkipLinespace();if(e.eol()){return u=="="?mt:gt}e.m_position=n}if(this.m_Markdown.ExtraMode){var l=Gt(e);if(l!=null){t.data=l;return Dt}e.m_position=n;if(r=="~"){if(this.ProcessFencedCodeBlock(e,t))return t.blockType;e.m_position=n}}var c=-1;var h=0;while(!e.eol()){if(e.current()==" "){if(c<0)h++}else if(e.current()=="	"){if(c<0)c=e.m_position}else{break}e.SkipForward(1)}if(e.eol()){t.contentLen=0;return ft}if(h>=4){t.contentStart=n+4;return St}if(c>=0&&c-n<4){t.contentStart=c+1;return St}t.contentStart=e.m_position;r=e.current();if(r=="<"){if(this.ScanHtml(e,t))return t.blockType;e.m_position=t.contentStart}if(r==">"){if(f(e.CharAtOffset(1))){e.SkipForward(2);t.contentStart=e.m_position;return yt}e.SkipForward(1);t.contentStart=e.m_position;return yt}if(r=="-"||r=="_"||r=="*"){var p=0;while(!e.eol()){var u=e.current();if(e.current()==r){p++;e.SkipForward(1);continue}if(f(e.current())){e.SkipForward(1);continue}break}if(e.eol()&&p>=3){return xt}e.m_position=t.contentStart}if(this.m_Markdown.ExtraMode&&r=="*"&&e.CharAtOffset(1)=="["){e.SkipForward(2);e.SkipLinespace();e.Mark();while(!e.eol()&&e.current()!="]"){e.SkipForward(1)}var d=v(e.Extract());if(e.current()=="]"&&e.CharAtOffset(1)==":"&&d){e.SkipForward(2);e.SkipLinespace();e.Mark();e.SkipToEol();var m=e.Extract();this.m_Markdown.AddAbbreviation(d,m);return ft}e.m_position=t.contentStart}if((r=="*"||r=="+"||r=="-")&&f(e.CharAtOffset(1))){e.SkipForward(1);e.SkipLinespace();t.contentStart=e.m_position;return wt}if(r==":"&&this.m_Markdown.ExtraMode&&f(e.CharAtOffset(1))){e.SkipForward(1);e.SkipLinespace();t.contentStart=e.m_position;return Pt}if(i(r)){e.SkipForward(1);while(i(e.current()))e.SkipForward(1);if(e.SkipChar(".")&&e.SkipLinespace()){t.contentStart=e.m_position;return bt}e.m_position=t.contentStart}if(r=="["){if(this.m_Markdown.ExtraMode&&e.CharAtOffset(1)=="^"){var g=e.m_position;e.SkipForward(2);var y=e.SkipFootnoteID();if(y!=null&&e.SkipChar("]")&&e.SkipChar(":")){e.SkipLinespace();t.contentStart=e.m_position;t.data=y;return jt}e.m_position=g}var w=R(e,this.m_Markdown.ExtraMode);if(w!=null){this.m_Markdown.AddLinkDefinition(w);return ft}}return Et};var Rt=0;var Ut=1;var zt=2;var Wt=3;var Xt=4;n.GetMarkdownMode=function(e){var t=e.attributes["markdown"];if(t==undefined){if(this.m_bMarkdownInHtml)return Wt;else return Rt}delete e.attributes["markdown"];if(t=="1")return(e.get_Flags()&L)!=0?zt:Ut;if(t=="block")return Ut;if(t=="deep")return Wt;if(t=="span")return zt;return Xt};n.ProcessMarkdownEnabledHtml=function(e,t,n,r){var i=e.m_position;var s=1;var o=false;while(!e.eof()){if(!e.Find("<"))break;var u=e.m_position;var a=M(e);if(a==null){e.SkipForward(1);continue}if(this.m_Markdown.SafeMode&&r==Xt&&!o){if(!a.IsSafe())o=true}if(a.closed)continue;if(a.name==n.name){if(a.closing){s--;if(s==0){e.SkipLinespace();e.SkipEol();t.blockType=Mt;t.data=n;t.set_contentEnd(e.m_position);switch(r){case zt:var f=this.CreateBlock(i);f.buf=e.buf;f.blockType=Ct;f.contentStart=i;f.contentLen=u-i;t.children=[];t.children.push(f);break;case Ut:case Wt:var l=new qt(this.m_Markdown,r==Wt);t.children=l.ProcessRange(e.buf,i,u-i);break;case Xt:if(o){t.blockType=Nt;t.set_contentEnd(e.m_position)}else{var f=this.CreateBlock(i);f.buf=e.buf;f.blockType=Tt;f.contentStart=i;f.contentLen=u-i;t.children=[];t.children.push(f)}break}return true}}else{s++}}}return false};n.ScanHtml=function(e,t){var n=e.m_position;var r=M(e);if(r==null)return false;if(r.closing)return false;var i=false;if(this.m_Markdown.SafeMode&&!r.IsSafe())i=true;var s=r.get_Flags();if((s&N)==0)return false;if((s&k)!=0||r.closed){e.SkipLinespace();e.SkipEol();t.contentLen=e.m_position-t.contentStart;t.blockType=i?Nt:Tt;return true}if((s&C)!=0){e.SkipLinespace();if(!e.eol())return false}var o=this.m_Markdown.ExtractHeadBlocks&&r.name.toLowerCase()=="head";var u=e.m_position;if(!o&&this.m_Markdown.ExtraMode){var a=this.GetMarkdownMode(r);if(a!=Rt){return this.ProcessMarkdownEnabledHtml(e,t,r,a)}}var f=null;var l=1;while(!e.eof()){if(!e.Find("<"))break;var c=e.m_position;var h=M(e);if(h==null){e.SkipForward(1);continue}if(this.m_Markdown.SafeMode&&!h.IsSafe())i=true;if(h.closed)continue;if(!o&&!h.closing&&this.m_Markdown.ExtraMode&&!i){var a=this.GetMarkdownMode(h);if(a!=Rt){var p=this.CreateBlock(n);if(this.ProcessMarkdownEnabledHtml(e,p,h,a)){if(f==null){f=[]}if(c>n){var d=this.CreateBlock(n);d.buf=e.buf;d.blockType=Tt;d.contentStart=n;d.contentLen=c-n;f.push(d)}f.push(p);n=e.m_position;continue}else{this.FreeBlock(p)}}}if(h.name==r.name&&!h.closed){if(h.closing){l--;if(l==0){e.SkipLinespace();e.SkipEol();if(i){t.blockType=Nt;t.set_contentEnd(e.m_position);return true}if(f!=null){if(e.m_position>n){var d=this.CreateBlock(n);d.buf=e.buf;d.blockType=Tt;d.contentStart=n;d.contentLen=e.m_position-n;f.push(d)}t.blockType=_t;t.set_contentEnd(e.m_position);t.children=f;return true}if(o){var m=e.buf.substr(u,c-u);this.m_Markdown.HeadBlockContent=this.m_Markdown.HeadBlockContent+v(m)+"\n";t.blockType=Tt;t.contentStart=e.position;t.contentEnd=e.position;t.lineStart=e.position;return true}t.blockType=Tt;t.contentLen=e.m_position-t.contentStart;return true}}else{l++}}}return ft};n.BuildList=function(e){var t=e[0].blockType;var n=e[0].get_leadingSpaces();for(var r=1;r<e.length;r++){if(e[r].blockType==Et&&(e[r-1].blockType==Et||e[r-1].blockType==t)){e[r-1].set_contentEnd(e[r].get_contentEnd());this.FreeBlock(e[r]);e.splice(r,1);r--;continue}if(e[r].blockType!=St&&e[r].blockType!=ft){var i=e[r].get_leadingSpaces();if(i>n){e[r].blockType=St;var s=e[r].get_contentEnd();e[r].contentStart=e[r].lineStart+i;e[r].set_contentEnd(s)}}}var o=this.CreateBlock(0);o.blockType=t==wt?Ot:At;o.children=[];for(var r=0;r<e.length;r++){var u=r;while(u>0&&e[u-1].blockType==ft)u--;var a=r;while(a<e.length-1&&e[a+1].blockType!=t)a++;if(u==a){o.children.push(this.CreateBlock().CopyFrom(e[r]))}else{var f=false;var l=this.m_Markdown.GetStringBuilder();for(var c=u;c<=a;c++){var h=e[c];l.Append(h.buf.substr(h.contentStart,h.contentLen));l.Append("\n");if(e[c].blockType==ft){f=true}}var p=this.CreateBlock();p.blockType=Lt;p.lineStart=e[u].lineStart;var d=new qt(this.m_Markdown);d.m_parentType=t;p.children=d.Process(l.ToString());if(!f){for(var c=0;c<p.children.length;c++){var v=p.children[c];if(v.blockType==Et){v.blockType=Ct}}}o.children.push(p)}r=a}o.lineStart=o.children[0].lineStart;this.FreeBlocks(e);e.length=0;return o};n.BuildDefinition=function(e){for(var t=1;t<e.length;t++){if(e[t].blockType==Et&&(e[t-1].blockType==Et||e[t-1].blockType==Pt)){e[t-1].set_contentEnd(e[t].get_contentEnd());this.FreeBlock(e[t]);e.splice(t,1);t--;continue}}var n=e[0].data;if(e.length==1&&!n){var r=e[0];e.length=0;return r}var i=this.m_Markdown.GetStringBuilder();for(var t=0;t<e.length;t++){var s=e[t];i.Append(s.buf.substr(s.contentStart,s.contentLen));i.Append("\n")}var o=this.CreateBlock(e[0].lineStart);o.blockType=Pt;var u=new qt(this.m_Markdown);u.m_parentType=Pt;o.children=u.Process(i.ToString());this.FreeBlocks(e);e.length=0;return o};n.BuildDefinitionLists=function(e){var t=null;for(var n=0;n<e.length;n++){switch(e[n].blockType){case Ht:case Pt:if(t==null){t=this.CreateBlock(e[n].lineStart);t.blockType=Bt;t.children=[];e.splice(n,0,t);n++}t.children.push(e[n]);e.splice(n,1);n--;break;default:t=null;break}}};n.BuildFootnote=function(e){for(var t=1;t<e.length;t++){if(e[t].blockType==Et&&(e[t-1].blockType==Et||e[t-1].blockType==jt)){e[t-1].set_contentEnd(e[t].get_contentEnd());this.FreeBlock(e[t]);e.splice(t,1);t--;continue}}var n=this.m_Markdown.GetStringBuilder();for(var t=0;t<e.length;t++){var r=e[t];n.Append(r.buf.substr(r.contentStart,r.contentLen));n.Append("\n")}var i=new qt(this.m_Markdown);i.m_parentType=jt;var s=this.CreateBlock(e[0].lineStart);s.blockType=jt;s.data=e[0].data;s.children=i.Process(n.ToString());this.FreeBlocks(e);e.length=0;return s};n.ProcessFencedCodeBlock=function(e,t){var n=e.m_position;e.Mark();while(e.current()=="~")e.SkipForward(1);var r=e.Extract();if(r.length<3)return false;e.SkipLinespace();if(!e.eol())return false;e.SkipEol();var i=e.m_position;if(!e.Find(r))return false;if(!l(e.CharAtOffset(-1)))return false;var s=e.m_position;e.SkipForward(r.length);e.SkipLinespace();if(!e.eol())return false;t.blockType=kt;t.children=[];s--;var o=this.CreateBlock(n);o.blockType=St;o.buf=e.buf;o.contentStart=i;o.contentLen=s-i;t.children.push(o);return true};var Vt=0;var $t=1;var Jt=2;var Kt=3;n=Qt.prototype;n.LeadingBar=false;n.TrailingBar=false;n.ParseRow=function(e){e.SkipLinespace();if(e.eol())return null;var t=this.LeadingBar;if(this.LeadingBar&&!e.SkipChar("|")){t=true;return null}var n=[];while(!e.eol()){e.Mark();while(!e.eol()&&e.current()!="|")e.SkipForward(1);n.push(v(e.Extract()));t|=e.SkipChar("|")}if(!t)return null;while(n.length<this.m_Columns.length){n.push("&nbsp;")}e.SkipEol();return n};n.RenderRow=function(e,t,n,r){for(var i=0;i<n.length;i++){t.Append("	<");t.Append(r);if(i<this.m_Columns.length){switch(this.m_Columns[i]){case $t:t.Append(' align="left"');break;case Jt:t.Append(' align="right"');break;case Kt:t.Append(' align="center"');break}}t.Append(">");e.m_SpanFormatter.Format2(t,n[i]);t.Append("</");t.Append(r);t.Append(">\n")}};n.Render=function(e,t){t.Append("<table>\n");if(this.m_Headers!=null){t.Append("<thead>\n<tr>\n");this.RenderRow(e,t,this.m_Headers,"th");t.Append("</tr>\n</thead>\n")}t.Append("<tbody>\n");for(var n=0;n<this.m_Rows.length;n++){var r=this.m_Rows[n];t.Append("<tr>\n");this.RenderRow(e,t,r,"td");t.Append("</tr>\n")}t.Append("</tbody>\n");t.Append("</table>\n")};this.Markdown=t;this.HtmlTag=A};var MarkdownDeepEditor=new function(){function b(e,t){return e.substr(0,t.length)==t}function w(e,t){return e.substr(-t.length)==t}function E(e){return e==" "||e=="	"||e=="\r"||e=="\n"}function S(e){return e=="\r"||e=="\n"}function x(e){var t=0;var n=e.length;while(t<n&&E(e.charAt(t)))t++;while(n-1>t&&E(e.charAt(n-1)))n--;return e.substr(t,n-t)}function T(e,t,n){if(e.addEventListener){e.addEventListener(t,n,false)}else if(e.attachEvent){e.attachEvent("on"+t,n)}}function N(e,t,n){if(e.removeEventListener){e.removeEventListener(t,n,false)}else if(e.detachEvent){e.detachEvent("on"+t,n)}}function C(e){if(e.preventDefault){e.preventDefault()}if(e.cancelBubble!==undefined){e.cancelBubble=true;e.keyCode=0;e.returnValue=false}return false}function k(e,t){return t-(e.value.slice(0,t).split("\r\n").length-1)}function L(){}function A(e,t,n,r){if(e<t)return e;return e<t+n?t:e+r-n}function O(t,n){if(!t.setSelectionRange){e=true}this.m_lastContent=null;this.m_undoStack=[];this.m_undoPos=0;this.m_undoMode=m;this.Markdown=new MarkdownDeep.Markdown;this.Markdown.SafeMode=false;this.Markdown.ExtraMode=true;this.Markdown.NewWindowForLocalLinks=true;this.Markdown.NewWindowForExternalLinks=true;this.m_textarea=t;this.m_divHtml=n;var r=this;T(t,"keyup",function(){r.onMarkdownChanged()});T(t,"keydown",function(e){return r.onKeyDown(e)});T(t,"paste",function(){r.onMarkdownChanged()});T(t,"input",function(){r.onMarkdownChanged()});T(t,"mousedown",function(){r.SetUndoMode(m)});this.onMarkdownChanged()}var e=false;var t=9;var n=13;var r=33;var i=34;var s=36;var o=35;var u=37;var a=39;var f=38;var l=40;var c=8;var h=46;var p=0;var d=1;var v=2;var m=3;var g=4;var y={Z:"undo",Y:"redo",B:"bold",I:"italic",H:"heading",K:"code",U:"ullist",O:"ollist",Q:"indent",E:"outdent",L:"link",G:"img",R:"hr",0:"h0",1:"h1",2:"h2",3:"h3",4:"h4",5:"h5",6:"h6"};M=L.prototype;M.InitFromTextArea=function(t){this.m_textarea=t;if(e){var n=document.selection.createRange();var r=n.duplicate();r.moveToElementText(t);var i=-r.moveStart("character",-1e7);this.m_selectionStart=-n.moveStart("character",-1e7)-i;this.m_selectionEnd=-n.moveEnd("character",-1e7)-i;this.m_text=t.value.replace(/\r\n/gm,"\n")}else{this.m_selectionStart=t.selectionStart;this.m_selectionEnd=t.selectionEnd;this.m_text=t.value}};M.Duplicate=function(){var e=new L;e.m_textarea=this.m_textarea;e.m_selectionEnd=this.m_selectionEnd;e.m_selectionStart=this.m_selectionStart;e.m_text=this.m_text;return e};M.Apply=function(){if(e){this.m_textarea.value=this.m_text;this.m_textarea.focus();var t=this.m_textarea.createTextRange();t.collapse(true);t.moveEnd("character",this.m_selectionEnd);t.moveStart("character",this.m_selectionStart);t.select()}else{var n=this.m_textarea.scrollTop;this.m_textarea.value=this.m_text;this.m_textarea.focus();this.m_textarea.setSelectionRange(this.m_selectionStart,this.m_selectionEnd);this.m_textarea.scrollTop=n}};M.ReplaceSelection=function(e){this.m_text=this.m_text.substr(0,this.m_selectionStart)+e+this.m_text.substr(this.m_selectionEnd);this.m_selectionEnd=this.m_selectionStart+e.length};M.ReplaceAt=function(e,t,n){this.m_text=this.m_text.substr(0,e)+n+this.m_text.substr(e+t);this.m_selectionStart=A(this.m_selectionStart,e,t,n.length);this.m_selectionEnd=A(this.m_selectionEnd,e,t,n.length)};M.getSelectedText=function(){return this.m_text.substr(this.m_selectionStart,this.m_selectionEnd-this.m_selectionStart)};M.InflateSelection=function(e,t){this.m_selectionEnd+=t;this.m_selectionStart-=e};M.PreceededBy=function(e){return this.m_selectionStart>=e.length&&this.m_text.substr(this.m_selectionStart-e.length,e.length)==e};M.FollowedBy=function(e){return this.m_text.substr(this.m_selectionEnd,e.length)==e};M.TrimSelection=function(){while(E(this.m_text.charAt(this.m_selectionStart)))this.m_selectionStart++;while(this.m_selectionEnd>this.m_selectionStart&&E(this.m_text.charAt(this.m_selectionEnd-1)))this.m_selectionEnd--};M.IsStartOfLine=function(e){return e==0||S(this.m_text.charAt(e-1))};M.FindStartOfLine=function(e){while(e>0&&!S(this.m_text.charAt(e-1))){e--}return e};M.FindEndOfLine=function(e){while(e<this.m_text.length&&!S(this.m_text.charAt(e))){e++}return e};M.FindNextLine=function(e){return this.SkipEol(this.FindEndOfLine(e))};M.SkipWhiteSpace=function(e){while(e<this.m_text.length&&E(this.m_text.charAt(e)))e++;return e};M.SkipEol=function(e){if(this.m_text.substr(e,2)=="\r\n")return e+2;if(S(this.m_text.charAt(e)))return e+1;return e};M.SkipPreceedingEol=function(e){if(e>2&&this.m_text.substr(e-2,2)=="\r\n")return e-2;if(e>1&&S(this.m_text.charAt(e-1)))return e-1;return e};M.SelectWholeLines=function(){this.m_selectionStart=this.FindStartOfLine(this.m_selectionStart);if(!this.IsStartOfLine(this.m_selectionEnd)){this.m_selectionEnd=this.SkipEol(this.FindEndOfLine(this.m_selectionEnd))}};M.SkipPreceedingWhiteSpace=function(e){while(e>0&&E(this.m_text.charAt(e-1))){e--}return e};M.SkipFollowingWhiteSpace=function(e){while(E(this.m_text.charAt(e))){e++}return e};M.SelectSurroundingWhiteSpace=function(){this.m_selectionStart=this.SkipPreceedingWhiteSpace(this.m_selectionStart);this.m_selectionEnd=this.SkipFollowingWhiteSpace(this.m_selectionEnd)};M.CheckSimpleSelection=function(){var e=this.getSelectedText();var t=e.match(/\n[ \t\r]*\n/);if(t){alert("Please make a selection that doesn't include a paragraph break");return false}return true};M.IsBlankLine=function(e){var t=this.m_text.length;for(var n=e;n<t;n++){var r=this.m_text[n];if(S(r))return true;if(!E(this.m_text.charAt(n)))return false}return true};M.FindStartOfParagraph=function(e){var t=e;e=this.FindStartOfLine(e);if(this.IsBlankLine(e))return e;while(e>0){var n=this.FindStartOfLine(this.SkipPreceedingEol(e));if(n==0)break;if(this.IsBlankLine(n))break;e=n}if(this.DetectListType(e).m_prefixLen!=0){e=this.FindStartOfLine(t);while(e>0){if(this.DetectListType(e).m_prefixLen!=0)return e;e=this.FindStartOfLine(this.SkipPreceedingEol(e))}}return e};M.FindEndOfParagraph=function(e){while(e<this.m_text.length){if(this.IsBlankLine(e))break;e=this.FindNextLine(e)}return e};M.SelectParagraph=function(){this.m_selectionStart=this.FindStartOfParagraph(this.m_selectionStart);this.m_selectionEnd=this.FindEndOfParagraph(this.m_selectionStart)};M.DetectListType=function(e){var t=this.m_text.substr(e,10);var n=t.match(/^\s{0,3}(\*|\d+\.)(?:\ |\t)*/);if(!n)return{m_listType:"",m_prefixLen:0};if(n[1]=="*")return{m_listType:"*",m_prefixLen:n[0].length};else return{m_listType:"1",m_prefixLen:n[0].length}};var M=O.prototype;var _=O.prototype;M.onKeyDown=function(p){var b=null;var w=true;if(p.ctrlKey||p.metaKey){var E=String.fromCharCode(p.charCode||p.keyCode);if(!this.disableShortCutKeys&&y[E]!=undefined){this.InvokeCommand(y[E]);return C(p)}switch(E){case"V":b=d;break;case"X":b=v;break}}else{switch(p.keyCode){case t:if(!this.disableTabHandling){this.InvokeCommand(p.shiftKey?"untab":"tab");return C(p)}else{b=d}break;case u:case a:case f:case l:case s:case o:case r:case i:b=m;break;case c:case h:b=v;break;case n:b=g;break;default:b=d}}if(b!=null)this.SetUndoMode(b);if(!this.disableAutoIndent){if(p.keyCode==n&&(!e||p.ctrlKey)){this.IndentNewLine()}}};M.SetUndoMode=function(e){if(this.m_undoMode==e)return;this.m_undoMode=e;this.CaptureUndoState()};M.CaptureUndoState=function(){var e=new L;e.InitFromTextArea(this.m_textarea);this.m_undoStack.splice(this.m_undoPos,this.m_undoStack.length-this.m_undoPos,e);this.m_undoPos=this.m_undoStack.length};M.onMarkdownChanged=function(e){var t=this.m_textarea.value;if(t===this.m_lastContent&&this.m_lastContent!==null)return;if(this.onPreTransform)this.onPreTransform(this,t);var n=this.Markdown.Transform(t);if(this.onPostTransform)this.onPostTransform(this,n);if(this.m_divHtml)this.m_divHtml.innerHTML=n;if(this.onPostUpdateDom)this.onPostUpdateDom(this);this.m_lastContent=t};_.onOptionsChanged=function(){this.m_lastContent=null;this.onMarkdownChanged()};_.cmd_undo=function(){if(this.m_undoPos>0){if(this.m_undoPos==this.m_undoStack.length){this.CaptureUndoState();this.m_undoPos--}this.m_undoPos--;this.m_undoStack[this.m_undoPos].Apply();this.m_undoMode=p;this.onMarkdownChanged()}};_.cmd_redo=function(){if(this.m_undoPos+1<this.m_undoStack.length){this.m_undoPos++;this.m_undoStack[this.m_undoPos].Apply();this.m_undoMode=p;this.onMarkdownChanged();if(this.m_undoPos==this.m_undoStack.length-1){this.m_undoStack.pop()}}};M.setHeadingLevel=function(e,t){e.SelectParagraph();e.SelectSurroundingWhiteSpace();var n=e.getSelectedText();n=x(n);var r=0;var i=n.match(/^(\#+)(.*?)(\#+)?$/);if(i){n=x(i[2]);r=i[1].length}else{i=n.match(/^(.*?)(?:\r\n|\n|\r)\s*(\-*|\=*)$/);if(i){n=x(i[1]);r=i[2].charAt(0)=="="?1:0}else{n=n.replace(/(\r\n|\n|\r)/gm,"");r=0}}if(t==-1)t=(r+1)%4;var s=0;var o=0;if(t==0){if(n=="Heading"){e.ReplaceSelection("");return true}o=n.length;s=0}else{if(n=="")n="Heading";s=t+1;o=n.length;var u="";for(var a=0;a<t;a++)u+="#";n=u+" "+n+" "+u}n+="\n\n";if(e.m_selectionStart!=0){n="\n\n"+n;s+=2}e.ReplaceSelection(n);e.m_selectionStart+=s;e.m_selectionEnd=e.m_selectionStart+o;return true};_.cmd_heading=function(e){return this.setHeadingLevel(e,-1)};_.cmd_h0=function(e){return this.setHeadingLevel(e,0)};_.cmd_h1=function(e){return this.setHeadingLevel(e,1)};_.cmd_h2=function(e){return this.setHeadingLevel(e,2)};_.cmd_h3=function(e){return this.setHeadingLevel(e,3)};_.cmd_h4=function(e){return this.setHeadingLevel(e,4)};_.cmd_h5=function(e){return this.setHeadingLevel(e,5)};_.cmd_h6=function(e){return this.setHeadingLevel(e,6)};M.IndentCodeBlock=function(e,t){e.SelectWholeLines();var n=e.getSelectedText().split("\n");for(var r=0;r<n.length;r++){if(n[r].charAt(0)=="	"){var i="";var s=0;while(n[r].charAt(s)=="	"){i+="    ";s++}var o=i+n[r].substr(s);n.splice(r,1,o)}}if(t===null){var r;for(r=0;r<n.length;r++){if(x(n[r])=="")continue;if(n[r].charAt(0)=="	"){var i="";var s=0;while(n[r].charAt(s)=="	"){i+="    ";s++}var o=i+n[r].substr(r);n.splice(r,1,o)}if(!b(n[r],"    "))break}t=r!=n.length}for(var r=0;r<n.length;r++){if(x(n[r])=="")continue;var u=n[r];if(t){u="    "+n[r]}else{if(b(n[r],"	"))u=n[r].substr(1);else if(b(n[r],"    "))u=n[r].substr(4)}n.splice(r,1,u)}e.ReplaceSelection(n.join("\n"))};_.cmd_code=function(e){if(e.m_selectionStart==e.m_selectionEnd){var t=e.FindStartOfLine(e.m_selectionStart);if(e.IsBlankLine(t)){e.SelectSurroundingWhiteSpace();e.ReplaceSelection("\n\n    Code\n\n");e.m_selectionStart+=6;e.m_selectionEnd=e.m_selectionStart+4;return true}}if(e.getSelectedText().indexOf("\n")<0){e.TrimSelection();if(e.PreceededBy("`"))e.m_selectionStart--;if(e.FollowedBy("`"))e.m_selectionEnd++;return this.bold_or_italic(e,"`")}this.IndentCodeBlock(e,null);return true};_.cmd_tab=function(e){if(e.getSelectedText().indexOf("\n")>0){this.IndentCodeBlock(e,true)}else{var t=e.FindStartOfLine(e.m_selectionStart);var n;for(n=t;n<e.m_selectionStart;n++){if(e.m_text.charAt(n)!=" ")break}if(n==e.m_selectionStart){var r=4-(n-t)%4;e.ReplaceSelection("    ".substr(0,r))}else{e.ReplaceSelection("	")}e.m_selectionStart=e.m_selectionEnd}return true};_.cmd_untab=function(e){if(e.getSelectedText().indexOf("\n")>0){this.IndentCodeBlock(e,false);return true}return false};M.bold_or_italic=function(e,t){var n=e.m_text;var r=t.length;var i=e.getSelectedText();if(b(i,t)&&w(i,t)){e.ReplaceSelection(i.substr(r,i.length-r*2))}else{e.TrimSelection();i=e.getSelectedText();if(!i)i="text";else i=i.replace(/(\r\n|\n|\r)/gm,"");e.ReplaceSelection(t+i+t);e.InflateSelection(-r,-r)}return true};_.cmd_bold=function(e){if(!e.CheckSimpleSelection())return false;e.TrimSelection();if(e.PreceededBy("**"))e.m_selectionStart-=2;if(e.FollowedBy("**"))e.m_selectionEnd+=2;return this.bold_or_italic(e,"**")};_.cmd_italic=function(e){if(!e.CheckSimpleSelection())return false;e.TrimSelection();if(e.PreceededBy("*")&&!e.PreceededBy("**")||e.PreceededBy("***"))e.m_selectionStart-=1;if(e.FollowedBy("*")&&!e.PreceededBy("**")||e.FollowedBy("***"))e.m_selectionEnd+=1;return this.bold_or_italic(e,"*")};M.indent_or_outdent=function(e,t){if(false&&e.m_selectionStart==e.m_selectionEnd){e.SelectSurroundingWhiteSpace();e.ReplaceSelection("\n\n> Quote\n\n");e.m_selectionStart+=4;e.m_selectionEnd=e.m_selectionStart+5;return true}e.SelectWholeLines();var n=e.getSelectedText().split("\n");for(var r=0;r<n.length-1;r++){var i=n[r];if(t){if(b(n[r],"> "))i=n[r].substr(2)}else{i="> "+n[r]}n.splice(r,1,i)}e.ReplaceSelection(n.join("\n"));return true};_.cmd_indent=function(e){return this.indent_or_outdent(e,false)};_.cmd_outdent=function(e){return this.indent_or_outdent(e,true)};M.handle_list=function(e,t){var n=[];if(e.getSelectedText().indexOf("\n")>0){e.SelectWholeLines();var r=e.m_selectionStart;n.push(r);while(true){r=e.FindNextLine(r);if(r>=e.m_selectionEnd)break;n.push(r)}}else{n.push(e.FindStartOfLine(e.m_selectionStart))}var i=t=="*"?"* ":"1. ";for(var s=0;s<n.length;s++){var o=e.DetectListType(n[s]);if(o.m_listType==t){i="";break}}for(var s=n.length-1;s>=0;s--){var r=n[s];var o=e.DetectListType(r);e.ReplaceAt(r,o.m_prefixLen,i)}var u=new MarkdownDeep.Markdown;u.ExtraMode=true;var a=u.GetListItems(e.m_text,e.m_selectionStart);while(a!=null){var f=0;for(var s=0;s<a.length-1;s++){var o=e.DetectListType(a[s]+f);if(o.m_listType!="1")break;var l=(s+1).toString()+". ";e.ReplaceAt(a[s]+f,o.m_prefixLen,l);f+=l.length-o.m_prefixLen}var c=u.GetListItems(e.m_text,a[a.length-1]+f);if(c!=null&&c[0]!=a[0])a=c;else a=null}if(n.length>1){e.SelectWholeLines()}return true};_.cmd_ullist=function(e){return this.handle_list(e,"*")};_.cmd_ollist=function(e){return this.handle_list(e,"1")};_.cmd_link=function(e){e.TrimSelection();if(!e.CheckSimpleSelection())return false;var t=prompt("Enter the target URL:");if(t===null)return false;var n=e.getSelectedText();if(n.length==0){n="link text"}var r="["+n+"]("+t+")";e.ReplaceSelection(r);e.m_selectionStart++;e.m_selectionEnd=e.m_selectionStart+n.length;return true};_.cmd_img=function(e){e.TrimSelection();if(!e.CheckSimpleSelection())return false;var t=prompt("Enter the image URL");if(t===null)return false;var n=e.getSelectedText();if(n.length==0){n="Image Text"}var r="!["+n+"]("+t+")";e.ReplaceSelection(r);e.m_selectionStart+=2;e.m_selectionEnd=e.m_selectionStart+n.length;return true};_.cmd_hr=function(e){e.SelectSurroundingWhiteSpace();if(e.m_selectionStart==0)e.ReplaceSelection("----------\n\n");else e.ReplaceSelection("\n\n----------\n\n");e.m_selectionStart=e.m_selectionEnd;return true};_.IndentNewLine=function(){var e=this;var t;var n=function(){window.clearInterval(t);var n=new L;n.InitFromTextArea(e.m_textarea);var r=n.FindStartOfLine(n.SkipPreceedingEol(n.m_selectionStart));var i=r;while(true){var s=n.m_text.charAt(i);if(s!=" "&&s!="	")break;i++}if(i>r){n.ReplaceSelection(n.m_text.substr(r,i-r));n.m_selectionStart=n.m_selectionEnd}n.Apply()};t=window.setInterval(n,1);return false};_.cmd_indented_newline=function(e){e.ReplaceSelection("\n");e.m_selectionStart=e.m_selectionEnd;var t=e.FindStartOfLine(e.SkipPreceedingEol(e.m_selectionStart));var n=t;while(true){var r=e.m_text.charAt(n);if(r!=" "&&r!="	")break;n++}if(n>t){e.ReplaceSelection(e.m_text.substr(t,n-t));e.m_selectionStart=e.m_selectionEnd}return true};_.InvokeCommand=function(e){if(e=="undo"||e=="redo"){this["cmd_"+e]();this.m_textarea.focus();return}var t=new L;t.InitFromTextArea(this.m_textarea);var n=t.Duplicate();if(this["cmd_"+e](t)){this.m_undoMode=p;this.m_undoStack.splice(this.m_undoPos,this.m_undoStack.length-this.m_undoPos,n);this.m_undoPos++;t.Apply();this.onMarkdownChanged();return true}else{this.m_textarea.focus();return false}};delete M;delete _;this.Editor=O};angular.module("wiz.markdown",["ngSanitize"]);angular.module("wiz.markdown").filter("wizMarkdownFltr",["wizMarkdownSvc",function(e){return function(t){if(t)return e.Transform(t)}}]);angular.module("wiz.markdown").factory("wizMarkdownSvc",[function(){var e=new MarkdownDeep.Markdown;e.ExtraMode=true;e.SafeMode=false;e.NewWindowForExternalLinks=true;e.AutoHeadingIDs=true;return e}]);angular.module("wiz.markdown").directive("wizMarkdown",["$filter","wizMarkdownSvc",function(e,t){return{restrict:"E",scope:{content:"="},replace:true,template:'<div class="markdown-output"></div>',link:function(e,n,r){e.$watch("content",function(){n.html(t.Transform(e.content))})}}}]).directive("wizMarkdownEditor",["$filter","wizMarkdownSvc",function(e,t){return{restrict:"E",scope:{content:"="},replace:true,template:'<div class="markdown-editor">'+'<textarea class="markdown-input" ng-model="content"></textarea>'+"</div>",link:function(e,t,n){var r=new MarkdownDeepEditor.Editor(t.find("textarea")[0],null);r.onPostUpdateDom=function(n){e.$apply(function(){e.content=t.find("textarea").val()})}}}}])